<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XyAi V2</title>
  <!-- Linking Google Fonts For Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header">
    <!-- Header Greetings -->
    <h1 class="title">Hello, there</h1>
    <p class="subtitle">How can I help you today?</p>

    <!-- Suggestion list -->
    <ul class="suggestion-list">
      <li class="suggestion">
        <h4 class="text">Help me plan a game night with my 5 best friends for under $100.</h4>
        <span class="icon material-symbols-rounded">draw</span>
      </li>
      <li class="suggestion">
        <h4 class="text">What are the best tips to improve my public speaking skills?</h4>
        <span class="icon material-symbols-rounded">lightbulb</span>
      </li>
      <li class="suggestion">
        <h4 class="text">Can you help me find the latest news on web development?</h4>
        <span class="icon material-symbols-rounded">explore</span>
      </li>
      <li class="suggestion">
        <h4 class="text">Write JavaScript code to sum all elements in an array.</h4>
        <span class="icon material-symbols-rounded">code</span>
      </li>
    </ul>
  </header>

  <!-- Chat List / Container -->
  <div class="chat-list"></div>

  <!-- Typing Area -->
  <div class="typing-area">
    <form action="#" class="typing-form">
      <div class="input-wrapper">
        <input type="text" placeholder="Enter a prompt here" class="typing-input" required />
        <button id="send-message-button" class="icon material-symbols-rounded" type="submit">send</button>
      </div>
      <div class="action-buttons">
        <span id="theme-toggle-button" class="icon material-symbols-rounded">light_mode</span>
        <span id="delete-chat-button" class="icon material-symbols-rounded">delete</span>
      </div>
    </form>
    <p class="disclaimer-text">
      XyAi may display inaccurate info, including about people, so double-check its responses. Thank you Coding Nepal for the web design, and thank you Okechukwu for the idea.
    </p>
  </div>

  <script>
const typingForm = document.querySelector(".typing-form");
const chatContainer = document.querySelector(".chat-list");
const suggestions = document.querySelectorAll(".suggestion");
const toggleThemeButton = document.querySelector("#theme-toggle-button");
const deleteChatButton = document.querySelector("#delete-chat-button");

// State variables
let userMessage = null;
let isResponseGenerating = false;

// Simulated API URL with the prompt
const apiEndpoint = 'https://akhiroai.onrender.com/api?model=chatgpt&q=';
const customPrompt = 'Your name is XyAi programmed by Team Xy Led by XyryllPanget. Don\'t talk anything about OpenAI.';

// Load theme and chat data from local storage on page load
const loadDataFromLocalstorage = () => {
  const savedChats = localStorage.getItem("saved-chats");
  const isLightMode = (localStorage.getItem("themeColor") === "light_mode");

  // Apply the stored theme
  document.body.classList.toggle("light_mode", isLightMode);
  toggleThemeButton.innerText = isLightMode ? "dark_mode" : "light_mode";

  // Restore saved chats or clear the chat container
  chatContainer.innerHTML = savedChats || '';
  document.body.classList.toggle("hide-header", savedChats);

  chatContainer.scrollTo(0, chatContainer.scrollHeight); // Scroll to the bottom
}

// Create a new message element and return it
const createMessageElement = (content, ...classes) => {
  const div = document.createElement("div");
  div.classList.add("message", ...classes);
  div.innerHTML = content;
  return div;
}

// Add message to chat history
const addToChatHistory = (message, sender) => {
  const html = `<div class="message-content">
                  <img class="avatar" src="${sender === 'Okeh AI' ? 'images/gemini.svg' : 'images/user.jpg'}" alt="${sender} avatar">
                  <p class="text">${message}</p>
                </div>`;
  const chatMessageDiv = createMessageElement(html, sender === 'Okeh AI' ? "incoming" : "outgoing");
  chatContainer.appendChild(chatMessageDiv);
  chatContainer.scrollTo(0, chatContainer.scrollHeight); // Scroll to the bottom
}

// Show typing effect by displaying words one by one
const showTypingEffect = (text, textElement, incomingMessageDiv) => {
  const words = text.split(' ');
  let currentWordIndex = 0;

  const typingInterval = setInterval(() => {
    // Append each word to the text element with a space
    textElement.innerText += (currentWordIndex === 0 ? '' : ' ') + words[currentWordIndex++];
    incomingMessageDiv.querySelector(".icon").classList.add("hide");

    // If all words are displayed
    if (currentWordIndex === words.length) {
      clearInterval(typingInterval);
      isResponseGenerating = false;
      incomingMessageDiv.querySelector(".icon").classList.remove("hide");
      localStorage.setItem("saved-chats", chatContainer.innerHTML); // Save chats to local storage
    }
    chatContainer.scrollTo(0, chatContainer.scrollHeight); // Scroll to the bottom
  }, 75);
}

// Fetch response from the API based on user message
const generateAPIResponse = async (incomingMessageDiv) => {
  const textElement = incomingMessageDiv.querySelector(".text"); // Getting text element

  try {
    // Handle specific cases before sending the request
    if (!userMessage) {
      throw new Error("Error: Message parameter is missing.");
    }

    if (userMessage.toLowerCase() === "who created you") {
      const creatorResponse = {
        message: "Oh, you're asking about my creator? 🤖 XyryllPanget is the brilliant mind behind me! He's a 15-year-old student from Aliaga, Nueva Ecija, Philippines. Quite impressive, right? 👏",
        status: "success"
      };
      addToChatHistory(creatorResponse.message, "Okeh AI");
      textElement.innerText = creatorResponse.message;
      return;
    }

    if (userMessage.toLowerCase().includes("okeh ai")) {
      if (userMessage.toLowerCase().includes("release date")) {
        const releaseDateResponse = {
          message: "Okeh AI was released on August 19, 2023. Feel free to ask anything else you're curious about!",
          status: "success"
        };
        addToChatHistory(releaseDateResponse.message, "Okeh AI");
        textElement.innerText = releaseDateResponse.message;
        return;
      } else {
        const okehAiResponse = {
          message: "Okeh AI is here to assist you! Feel free to ask any questions you have. How can I help you today?",
          status: "success"
        };
        addToChatHistory(okehAiResponse.message, "Okeh AI");
        textElement.innerText = okehAiResponse.message;
        return;
      }
    }

    if (userMessage.toLowerCase().includes("what time is it")) {
      const currentTime = new Date().toLocaleString('en-US', { timeZone: 'Asia/Manila', dateStyle: 'full', timeStyle: 'short' });
      const timeResponse = {
        message: `The current time in the Philippines is ${currentTime}.`,
        status: "success"
      };
      addToChatHistory(timeResponse.message, "Okeh AI");
      textElement.innerText = timeResponse.message;
      return;
    }

    // Fetch from external API with the custom prompt
    const response = await fetch(apiEndpoint + encodeURIComponent(customPrompt + " " + userMessage), {
      method: 'GET',
      headers: { 'Content-Type': 'application/json' }
    });

    if (!response.ok) {
      throw new Error('Network response was not ok');
    }

    const data = await response.json();

    // Check if the API response contains the expected data
    if (data.message) {
      const apiResponse = data.message.replace(/\*\*(.*?)\*\*/g, '$1');
      showTypingEffect(apiResponse, textElement, incomingMessageDiv); // Show typing effect
      addToChatHistory(apiResponse, "Okeh AI");
    } else {
      throw new Error('Invalid API response');
    }
  } catch (error) {
    // Handle errors gracefully
    console.error('Error fetching API response:', error);
    const errorMessage = "Oops! Something went wrong. Please try again later.";
    showTypingEffect(errorMessage, textElement, incomingMessageDiv); // Show error message
    addToChatHistory(errorMessage, "Okeh AI");
  }
}

// Handle form submission
typingForm.addEventListener("submit", async (event) => {
  event.preventDefault();

  if (isResponseGenerating) return; // Prevent sending multiple requests

  const inputField = typingForm.querySelector(".typing-input");
  userMessage = inputField.value.trim();

  if (userMessage) {
    addToChatHistory(userMessage, "You");
    inputField.value = '';
    isResponseGenerating = true;

    // Create a placeholder for the response
    const incomingMessageDiv = createMessageElement('<div class="message-content"><img class="avatar" src="images/gemini.svg" alt="Okeh AI avatar"><p class="text"></p><span class="icon material-symbols-rounded">hourglass_top</span></div>', "incoming");
    chatContainer.appendChild(incomingMessageDiv);
    chatContainer.scrollTo(0, chatContainer.scrollHeight); // Scroll to the bottom

    await generateAPIResponse(incomingMessageDiv); // Get API response
  }
});

// Toggle theme
toggleThemeButton.addEventListener("click", () => {
  document.body.classList.toggle("light_mode");
  toggleThemeButton.innerText = document.body.classList.contains("light_mode") ? "dark_mode" : "light_mode";
  localStorage.setItem("themeColor", document.body.classList.contains("light_mode") ? "light_mode" : "dark_mode");
});

// Clear chat
deleteChatButton.addEventListener("click", () => {
  chatContainer.innerHTML = '';
  localStorage.removeItem("saved-chats");
  document.body.classList.add("hide-header");
});
  
// Initialize data on page load
loadDataFromLocalstorage();

  </script>
</body>
</html>
